<!DOCTYPE html>
<head>
    <title>DAFFMAN - File Browser</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" 
      rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" 
      crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" 
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" 
      crossorigin="anonymous">
    </script> -->
    
    <script src="js/bootstrap.bundle.min.js"></script>


    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      .b-example-divider {
        height: 3rem;
        background-color: rgba(0, 0, 0, .1);
        border: solid rgba(0, 0, 0, .15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
      }
      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }
      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }
      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }
      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .form-control {
          color: #fff;
      }

      .form-control:focus {
          color: #fff;
      }


    </style>
    <link href="navbar-top-fixed.css" rel="stylesheet">
</head>
<body style="background-color: #212121; color: white;">
    

    <!-- As a link -->
    <header class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="index.php" fill="blue">
              <span class="fs-4">DAFFMAN&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;</span>
          </a>
          <hr>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <a href="/browser">
              <button class="btn btn-primary" type="submit">
                Dashboard
              </button>
            </a>
            <ul class="navbar-nav me-auto mb-2 mb-md-0">
            </ul>
            <a href="index.php">
              <button class="btn btn-danger" type="submit" fill="red">
                Sign Out
              </button>
            </a>
          </div>
        </div>
      </header>
      <div class="container-fluid">
        <div class="row">
          <nav id="sidebarMenu" class="col-md-3 col-lg-1 d-md-block sidebar collapse" style="background-color: #02355e;">
            <div class="position-sticky pt-3 sidebar-sticky">
              <hr>
            </div>
          </nav>
            <main class="col-md-9 ms-sm-auto col-lg-11 px-md-4" height="10000">
              <canvas class="my-4 w-100" id="myChart" width="200" height="5"></canvas>
                <h3>Path: {{ path }}</h3>
                  <hr>
                  <br>
                <div class="table-responsive">
                  <h3><u>Folders and Directories</u></h3><br>
                  {% if current_dir != '/home/daniel/Desktop/Flask-file-manager/flask-manager' %}
                    <form action="/md">
                      <input type="text" name="folder" placeholder="Enter folder name..."/>
                      <input type="submit" value="New Folder"/>
                    </form><br>
                  {% else %}
                    <h3>File uploads not allowed here...</h3>
                  {% endif %}
                  <table class="table table-dark">
                    <thead>
                      <th scope="col">Folder</th>
                      <th scope="col">Actions</th>
                    </thead>
                    {% if current_dir != '/home/daniel/Desktop/Flask-file-manager/flask-manager' %}
                    <tr>
                      <td>
                          <a href="/cd?path=..">
                            <button class="btn btn-primary" type="submit" fill="red">
                              .. (Parent Folder)
                            </button>
                          </a>
                      </td>
                      <td></td>
                    </tr>
                    {% endif %}
                {% for item in files[0: -1] %}
                    <tr>
                    {% if '.' not in item  %}
                        {% if item == 'static' or item == 'templates' or item == '__pycache__' %}
                        <!-- <td><p>{{item + '/'}}</p></td>
                        <td>System Directory (No Access)</td> -->
                        {% elif item == 'uploads' %}
                        <td><a href="/cd?path={{current_dir + '/' + item}}"><p>{{item + '/'}}</p></a></td>
                        <td>System Directory</td>
                        {% else %}
                        <td><a href="/cd?path={{current_dir + '/' + item}}"><p>{{item + '/'}}</p></a></td>
                        <td><a href="/delete_dir?dir={{current_dir + '/' + item}}">
                          <button class="btn btn-danger" type="submit" fill="red">
                          Remove Directory
                          </button></a></td>
                        {% endif %}
                    
                    {% endif %}
                    </tr>
                {% endfor %}
                  </table>
                  <p> {{ numfolder }} entries found </p>

<!-- ------------------------------   -->

              <a id="files"></a>
                  <br><br>
                  <hr size="10">
                
                    <h3><u>Files</u></h3><br>
                    <form action="/upload" method="POST" enctype = "multipart/form-data">
                      <input type="file" name="file" value="Choose File"/>
                      <input type = "submit" value="Upload New File"/>
                      <input type="reset" value="Clear Selection">
                    </form><br>
                    {% if fileexist == True %}
                      <p class="alert alert-danger">File Already Exists<br>
                        Note: Similar file name and MD5 found 
                      </p>
                    {% endif %}
                    <table class="table table-dark">
                      <thead>
                        <th scope="col">File</th>
                        <th scope="col">Size</th>
                        <th scope="col">md5</th>
                        <th scope="col">Actions</th>
                        <th scope="col"></th>
                      </thead>
                  {% for item in hash_list %}
                      {% if '.' not in item[0]  %}
                      
                      {% else %}
                              <!-- prohibit .py and .html for now -->
                              {% if item[0].endswith(('.html', '.py')) %}
                                    <!-- file name -->
                                    <td>{{ item[0] }}&nbsp;&nbsp; 
                                      <a href="/view?file={{current_dir + '/' + item[0]}}&item={{item[0]}}">(View File)</a>
                                    </td> file name
                                    <!-- file size -->
                                    <td> {{ item[1] }} KB</td> 
                                    <!-- file hash --> 
                                    <td>{{ item[2] }}</td>
                                    <td><a href="/download?file={{ current_dir + '/' + item[0] }}">
                                      <button class="btn btn-primary" type="submit">
                                        Download
                                      </button></a>
                                    </td>
                                    <td><a href="/delete?file={{current_dir + '/' + item[0] }}">
                                      <button class="btn btn-danger" type="submit" fill="red">
                                        Delete
                                      </button></a>
                                    </td>
                              <!-- check if it's text file for view URL -->
                              {% elif item[0].endswith(('.txt', '.md')) %}
                                    <!-- file name -->
                                    <td>{{ item[0] }}&nbsp;&nbsp;<a href="/view?file={{ current_dir + '/' + item[0] }}&item={{ item[0] }}">(View File)</a></td>
                                    <!-- file size -->
                                    <td>{{ item[1] }} KB</td>
                                    <!-- file hash -->
                                    <td>{{ item[2] }}</td>
                                    <td><a href="/download?file={{current_dir + '/' + item[0]}}">
                                      <button class="btn btn-primary" type="submit">
                                        Download
                                      </button></a>
                                    </td>
                                    <td><a href="/delete?file={{current_dir + '/' + item[0]}}">
                                      <button class="btn btn-danger" type="submit" fill="red">
                                        Delete
                                        </button></a>
                                    </td>
                              {% else %}
                                    <td>{{ item[0] }}</td>
                                    <!-- file size -->
                                    <td>{{ item[1] }} KB</td>
                                    <!-- file hash -->
                                    <td>{{ item[2] }}</td>
                                    <td><a href="/download?file={{current_dir + '/' + item[0]}}">
                                      <button class="btn btn-primary" type="submit">
                                        Download
                                        </button></a>
                                      </td>
                                    <td><a href="/delete?file={{current_dir + '/' + item[0]}}">
                                      <button class="btn btn-danger" type="submit" fill="red">
                                        Delete
                                        </button></a>
                                    </td>
                              {% endif %}
                            <!-- unreadable file for download only -->
                            <!-- unreadable file for download only -->
                      {% endif %}
                      </tr>
                  {% endfor %}
                    </table>
                    <p>{{ numfiles }} entries found</p>
                  </div>
                </a>
                <br><br><br><br>
                <br><br>
                <h3>==== README.md ====</h3>
                <hr>
                  {{ note|markdown }}
                  <hr>
                  <br>
                <footer>
                  <p>2023 &copy; Muhammad Danial. The repository is 
                    <a href="https://github.com/dandeviant/Flask-file-manager">open to public </a>
                  </p>
                </footer> 
              <canvas class="my-4 w-100" id="myChart" width="300" height="100"></canvas>
            </main>
        </div>
      </div> 


</body>
</html>